"use strict";var _createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},WebDB=function(){var a=function(b){var c=this;_classCallCheck(this,a);var d={name:void 0,version:"1.0",description:"",initialize:function(){console.info("New Database Created")}};switch(typeof b){case"undefined":return console.error("WebDB instance requires configuration");case"string":this.databaseName=d.name=b;break;case"object":if(!b.name)return console.error("WebDB instance requires `name` configuration");this.databaseName=d.name=b.name,b.version&&(d.version=b.version),b.description&&(d.description=b.description),b.initialize&&(d.initialize=b.initialize)}return this.database=openDatabase(d.name,d.version,d.description,2097152,d.initialize),this.getTables(),setTimeout(function(){c.trigger("ready")},0),this};return _createClass(a,{getName:{value:function(){return this.databaseName}},getTables:{value:function(){var a=this,b={id:this.identifyTransaction(),statement:this.sanitizeStatement("\n        SELECT tbl_name, sql\n        FROM sqlite_master\n        WHERE type='table'\n      ")};return this.transaction(b),this.on(b.id,function(b){if("error"===b.status)return console.error("Couldn't retrieve tables from database",b.result);for(var c=b.result.rows,d=0;d<c.length;){var e=c.item(d),f=e.tbl_name;"__WebKitDatabaseInfoTable__"===f||a[f]||(a[f]=new WebDB.Table(a,f)),d+=1}},!0),this}},createTable:{value:function b(a,c){var d=this,b=function(){if(null==c.columns)return console.error("WebDB.createTable requires `configuration.columns`");var b=[];(!c.autoIndexID||c.autoIndexID&&c.autoIndexID!==!1)&&b.push("id INTEGER PRIMARY KEY"),Object.keys(c.columns).forEach(function(a){b.push(""+a+" "+c.columns[a].toUpperCase())});var e={id:d.identifyTransaction(),statement:d.sanitizeStatement("\n          CREATE TABLE IF NOT EXISTS\n          "+a+"\n          ("+b.join(",")+")\n        ")};d.transaction(e),d.on(e.id,function(b){return"error"===b.status&&null!=c.error?c.error(b.result):"success"===status?(d.getTables(),null!=c.success&&c.success(b.result),d[a]):void 0},!0)};if(c.overwrite){var e={id:this.identifyTransaction(),statement:this.sanitizeStatement("\n          DROP TABLE IF EXISTS "+a+"\n        ")};this.transaction(e),this.on(e.id,b,!0)}else b();return this}}}),a}();WebDB.prototype.events={},WebDB.prototype.transactions={},WebDB.prototype.transactionIdentifier=0,WebDB.prototype.identifyTransaction=function(){return this.transactionIdentifier=this.transactionIdentifier+1},WebDB.prototype.transaction=function(a){var b=this;return this.database.transaction(function(c){var d=a.id,e=a.statement;c.executeSql(e,[],function(a,c){b.trigger(d,{status:"success",transaction:a,result:c},!0,e)},function(a,c){b.trigger(d,{status:"error",transaction:a,result:c},!0,e)})}),this},WebDB.prototype.on=function(a,b,c){var d=c?this.transactions:this.events;return d[a]=b,this},WebDB.prototype.trigger=function(a,b,c,d){var e=c?this.transactions:this.events;return e[a]&&(e[a].call(this,b),c&&d&&(this.transactions[a]=d)),this},WebDB.prototype.sanitizeStatement=function(a){return a=a.replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/^ | $/g,"")},WebDB.Row=function(){var a=function(b,c){var d=this;return _classCallCheck(this,a),this.database=b,Object.keys(c).forEach(function(a){d[a]=c[a]}),this};return a}(),WebDB.Table=function(){var a=function(b,c){var d=this;_classCallCheck(this,a),this.database=b,this.tableName=c,this.rows=[];var e={id:this.database.identifyTransaction(),statement:this.database.sanitizeStatement("\n        SELECT *\n        FROM "+this.tableName+"\n      ")};return this.database.transaction(e),this.database.on(e.id,function(a){return"error"===a.status?console.error("Couldn't retrieve rows for table "+d.tableName,a.result):void d.setupRows(a.result.rows)},!0),this};return _createClass(a,{count:{value:function(){return this.rows.length}},get:{value:function(a){return this.rows[a]}},drop:{value:function(){var a=this,b={id:this.database.identifyTransaction(),statement:this.database.sanitizeStatement("\n        DROP TABLE "+this.tableName+"\n      ")};this.database.transaction(b),this.database.on(b.id,function(b){return"error"===b.status?console.error("Could not drop table "+a.tableName,b.result):delete a.database[a.tableName]},!0)}},insert:{value:function(a){var b=this,c=[];return"[object Array]"===Object.prototype.toString.call(a)?c=a:"object"==typeof a&&c.push(a),c.forEach(function(a){var c=[],d=[];Object.keys(a).forEach(function(b){c.push(b),d.push('"'+a[b]+'"')});var e={id:b.database.identifyTransaction(),statement:b.database.sanitizeStatement("\n          INSERT INTO "+b.tableName+"\n          ("+c.join(",")+") VALUES\n          ("+d.join(",")+")\n        ")};b.database.transaction(e),b.database.on(e.id,function(a){return"error"===a.status?console.error("Could not insert row in to table "+b.tableName,a.result):void b.setupRows(a.result.rows)},!0)}),this}},remove:{value:function(){}}}),a}(),WebDB.Table.prototype.setupRows=function(a){for(var b=0;b<a.length;){var c=a.item(b);this.rows.push(new WebDB.Row(this.database,c)),b+=1}};