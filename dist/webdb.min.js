"use strict";var _createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},WebDB=function(){var a=function(b){_classCallCheck(this,a);var c={name:void 0,version:"1.0",description:"",initialize:function(){console.info("New Database Created")}};switch(typeof b){case"undefined":return console.error("WebDB instance requires configuration");case"string":this.databaseName=c.name=b;break;case"object":if(!b.name)return console.error("WebDB instance requires `name` configuration");this.databaseName=c.name=b.name,b.version&&(c.version=b.version),b.description&&(c.description=b.description),b.initialize&&(c.initialize=b.initialize)}this.database=openDatabase(c.name,c.version,c.description,2097152,c.initialize),this._transactions={},this._transactionIdentifier=0,this._getTables()};return _createClass(a,{getName:{value:function(){return this.databaseName}},_identifyTransaction:{value:function(){return this._transactionIdentifier=this._transactionIdentifier+1}},_transaction:{value:function(a){var b=this;this.database.transaction(function(c){c.executeSql(a.statement,[],function(c,d){b._transactions[a.id].apply(b,["success",c,d])},function(c,d){b._transactions[a.id].apply(b,["error",c,d])})})}},_done:{value:function(a,b){this._transactions[a]=b}},_getTables:{value:function(){var a=this._identifyTransaction();this._transaction({id:a,statement:"SELECT tbl_name, sql from sqlite_master WHERE type='table'"}),this._done(a,function(a,b,c){if("fail"==a)return console.error("Could not retrieve existing tables from database",c);for(var d=c.rows,e=0;e<d.length;){var f=d.item(e),g=f.tbl_name;"__WebKitDatabaseInfoTable__"===g||this[g]||(this[g]=this._getTable.bind({tableName:g,database:this})),e+=1}})}}}),a}();WebDB.prototype.createTable=function(a,b){var c=this,d=function(){if(null==b.columns)return console.error("WebDB.createTable requires `configuration.columns` configuration");var d=[];Object.keys(b.columns).forEach(function(a){d.push(""+a+" "+b.columns[a].toUpperCase())}),b.autoIndexID&&b.autoIndexID!==!1&&d.push("_id INTEGER PRIMARY KEY");var e={id:c._identifyTransaction(),statement:"\n        CREATE TABLE IF NOT EXISTS\n        "+a+"\n        ("+d.join(",")+")\n      "};e.statement=e.statement.replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/^ | $/g,""),c._transaction(e),c._done(e.id,function(d,e,f){return"error"===d&&null!=b.error?b.error(f):"success"===d?(c._getTables(),null!=b.success&&b.success(f),c.getTable(a)):void 0})};if(b.overwrite){var e=this._identifyTransaction();this._transaction({id:e,statement:"DROP TABLE IF EXISTS ${name}"}),this._done(dropID,d)}else d()},WebDB.prototype._getTable=function(){var a=this.database._identifyTransaction();this.database._transaction({id:a,statement:"SELECT * FROM "+this.tableName}),this.database._done(a,function(a,b,c){return"error"==a?console.error("Could not retrieve table "+this.tableNam+" from database",c):"success"==a?console.log("yay",c):void 0})},WebDB.prototype.getTable=function(a){return this._getTable.bind({tableName:a,database:this}).call()};