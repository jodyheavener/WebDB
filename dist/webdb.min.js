"use strict";var _createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},WebDB=function(){var a=function(b){_classCallCheck(this,a);var c={name:void 0,version:"1.0",description:"",initialize:function(){console.info("New Database Created")}};switch(typeof b){case"undefined":return console.error("WebDB instance requires configuration");case"string":this.databaseName=c.name=b;break;case"object":if(!b.name)return console.error("WebDB instance requires `name` configuration");this.databaseName=c.name=b.name,b.version&&(c.version=b.version),b.description&&(c.description=b.description),b.initialize&&(c.initialize=b.initialize)}return this.database=openDatabase(c.name,c.version,c.description,2097152,c.initialize),this.getTables(),this.ready=!0};return _createClass(a,{getName:{value:function(){return this.databaseName}},getTables:{value:function(){var a=this,b={id:this.identifyTransaction(),statement:this.sanitizeStatement("\n        SELECT tbl_name, sql\n        FROM sqlite_master\n        WHERE type='table'\n      ")};return this.transaction(b),this.done(b.id,function(b,c,d){if("error"===b)return console.error("Could not retrieve existing tables from database",d);for(var e=d.rows,f=0;f<e.length;){var g=e.item(f),h=g.tbl_name;"__WebKitDatabaseInfoTable__"===h||a[h]||(a[h]=new WebDB.Table(a,h)),f+=1}}),this}},createTable:{value:function b(a,c){var d=this,b=function(){if(null==c.columns)return console.error("WebDB.createTable requires `configuration.columns` configuration");var b=[];(!c.autoIndexID||c.autoIndexID&&c.autoIndexID!==!1)&&b.push("id INTEGER PRIMARY KEY"),Object.keys(c.columns).forEach(function(a){b.push(""+a+" "+c.columns[a].toUpperCase())});var e={id:d.identifyTransaction(),statement:d.sanitizeStatement("\n          CREATE TABLE IF NOT EXISTS\n          "+a+"\n          ("+b.join(",")+")\n        ")};d.transaction(e),d.done(e.id,function(b,e,f){return"error"===b&&null!=c.error?c.error(f):"success"===b?(d.getTables(),null!=c.success&&c.success(f),d[a]):void 0})};if(c.overwrite){var e={id:this.identifyTransaction(),statement:this.sanitizeStatement("\n          DROP TABLE IF EXISTS "+a+"\n        ")};this.transaction(e),this.done(e.id,b)}else b()}}}),a}();WebDB.prototype.transactions={},WebDB.prototype.transactionIdentifier=0,WebDB.prototype.identifyTransaction=function(){return this.transactionIdentifier=this.transactionIdentifier+1},WebDB.prototype.transaction=function(a){var b=this;return this.database.transaction(function(c){var d=a.id,e=a.statement;c.executeSql(e,[],function(a,c){b.transactions[d].apply(b,["success",a,c]),b.transactions[d]=e},function(a,c){b.transactions[d].apply(b,["error",a,c]),b.transactions[d]=e})}),this},WebDB.prototype.done=function(a,b){return this.transactions[a]=b},WebDB.prototype.sanitizeStatement=function(a){return a=a.replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/^ | $/g,"")},WebDB.Row=function(){var a=function(b,c){var d=this;return _classCallCheck(this,a),this.database=b,Object.keys(c).forEach(function(a){d[a]=c[a]}),this};return a}(),WebDB.Table=function(){var a=function(b,c){var d=this;_classCallCheck(this,a),this.database=b,this.tableName=c,this.rows=[];var e={id:this.database.identifyTransaction(),statement:this.database.sanitizeStatement("\n        SELECT *\n        FROM "+this.tableName+"\n      ")};return this.database.transaction(e),this.database.done(e.id,function(a,b,c){return"error"===a?console.error("Could not retrieve rows for table "+d.tableName,c):void d.setupRows(c.rows)}),this};return _createClass(a,{count:{value:function(){return this.rows.length}},get:{value:function(a){return this.rows[a]}},drop:{value:function(){var a=this,b={id:this.database.identifyTransaction(),statement:this.database.sanitizeStatement("\n        DROP TABLE "+this.tableName+"\n      ")};this.database.transaction(b),this.database.done(b.id,function(b,c,d){return"error"===b?console.error("Could not drop table "+a.tableName,d):delete a.database[a.tableName]})}},insert:{value:function(a){var b=this,c=[];return"[object Array]"===Object.prototype.toString.call(a)?c=a:"object"==typeof a&&c.push(a),c.forEach(function(a){var c=[],d=[];Object.keys(a).forEach(function(b){c.push(b),d.push('"'+a[b]+'"')});var e={id:b.database.identifyTransaction(),statement:b.database.sanitizeStatement("\n          INSERT INTO "+b.tableName+"\n          ("+c.join(",")+") VALUES\n          ("+d.join(",")+")\n        ")};b.database.transaction(e),b.database.done(e.id,function(a,c,d){return"error"===a?console.error("Could not insert row in to table "+b.tableName,d):void b.setupRows(d.rows)})}),this}},remove:{value:function(){}}}),a}(),WebDB.Table.prototype.setupRows=function(a){for(var b=0;b<a.length;){var c=a.item(b);this.rows.push(new WebDB.Row(this.database,c)),b+=1}};