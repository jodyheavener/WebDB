"use strict";var _createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},WebDB=function(){var a=function(b){_classCallCheck(this,a);var c={name:void 0,version:"1.0",description:"",initialize:function(){console.info("New Database Created")}};switch(typeof b){case"undefined":return console.error("WebDB instance requires configuration");case"string":this.databaseName=c.name=b;break;case"object":if(!b.name)return console.error("WebDB instance requires `name` configuration");this.databaseName=c.name=b.name,b.version&&(c.version=b.version),b.description&&(c.description=b.description),b.initialize&&(c.initialize=b.initialize)}return this.database=openDatabase(c.name,c.version,c.description,2097152,c.initialize),this.getTables(),this.ready=!0};return _createClass(a,{getName:{value:function(){return this.databaseName}},getTables:{value:function(){var a=this,b=this.identifyTransaction();return this.transaction({id:b,statement:"SELECT tbl_name, sql from sqlite_master WHERE type='table'"}),this.done(b,function(b,c,d){if("error"===b)return console.error("Could not retrieve existing tables from database",d);for(var e=d.rows,f=0;f<e.length;){var g=e.item(f),h=g.tbl_name;"__WebKitDatabaseInfoTable__"===h||a[h]||(a[h]=new WebDB.dbTable(a,h)),f+=1}}),this}},createTable:{value:function b(a,c){var d=this,b=function(){if(null==c.columns)return console.error("WebDB.createTable requires `configuration.columns` configuration");var b=[];Object.keys(c.columns).forEach(function(a){b.push(""+a+" "+c.columns[a].toUpperCase())}),c.autoIndexID&&c.autoIndexID!==!1&&b.push("_id INTEGER PRIMARY KEY");var e={id:d.identifyTransaction(),statement:"\n          CREATE TABLE IF NOT EXISTS\n          "+a+"\n          ("+b.join(",")+")\n        "};e.statement=e.statement.replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/^ | $/g,""),d.transaction(e),d.done(e.id,function(b,e,f){return"error"===b&&null!=c.error?c.error(f):"success"===b?(d.getTables(),null!=c.success&&c.success(f),d[a]):void 0})};if(c.overwrite){var e=this.identifyTransaction();this.transaction({id:e,statement:"DROP TABLE IF EXISTS ${name}"}),this.done(dropID,b)}else b()}}}),a}();WebDB.prototype.transactions={},WebDB.prototype.transactionIdentifier=0,WebDB.prototype.identifyTransaction=function(){return this.transactionIdentifier=this.transactionIdentifier+1},WebDB.prototype.transaction=function(a){var b=this;return this.database.transaction(function(c){c.executeSql(a.statement,[],function(c,d){b.transactions[a.id].apply(b,["success",c,d])},function(c,d){b.transactions[a.id].apply(b,["error",c,d])})}),this},WebDB.prototype.done=function(a,b){return this.transactions[a]=b},WebDB.dbRow=function(){var a=function(b){return _classCallCheck(this,a),this.database=b,{row:"yes"}};return a}(),WebDB.dbTable=function(){var a=function(b,c){var d=this;_classCallCheck(this,a),this.database=b,this.tableName=c,this.rows=[];var e=this.database.identifyTransaction();return this.database.transaction({id:e,statement:"SELECT * from "+this.tableName}),this.database.done(e,function(a,b,c){if("error"===a)return console.error("Could not retrieve rows for table "+d.tableName,c);for(var e=c.rows,f=0;f<e.length;){var g=e.item(f);d.rows.push(new WebDB.dbRow(d.database,g)),f+=1}}),this};return _createClass(a,{count:{value:function(){return this.rows.length}},drop:{value:function(){var a=this,b=this.database.identifyTransaction();this.database.transaction({id:b,statement:"DROP TABLE "+this.tableName}),this.database.done(b,function(b,c,d){return"error"===b?console.error("Could not drop table "+a.tableName,d):delete a.database[a.tableName]})}},insert:{value:function(a,b){var c={};"string"==typeof a&&null!=b?c[a]=b:"object"==typeof a&&(c=a),console.log(c)}},remove:{value:function(){}}}),a}();